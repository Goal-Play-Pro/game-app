/**
 * AI Knowledge Service - Base de conocimiento completa de Goal Play
 * Contiene TODA la informaci√≥n del ecosistema para el agente AI
 */

export class AIKnowledgeService {
  
  // üéÆ CONOCIMIENTO COMPLETO DEL JUEGO
  static readonly GAME_MECHANICS = {
    penalty_system: {
      description: 'Sistema determin√≠stico de penalty shootout basado en stats reales',
      formula: 'sumSubstats / maxStats * (maxPercentage - startingPercentage) + startingPercentage',
      factors: ['Stats del jugador', 'Divisi√≥n', 'Direcci√≥n elegida', 'Potencia del disparo', 'Direcci√≥n del portero'],
      probability_ranges: {
        primera: '50% inicial ‚Üí 90% m√°ximo',
        segunda: '40% inicial ‚Üí 80% m√°ximo', 
        tercera: '30% inicial ‚Üí 70% m√°ximo'
      },
      gameplay_flow: [
        'Seleccionar jugador entrenado (nivel 5+ y 500 XP)',
        'Elegir modo: Single Player vs IA o Multiplayer PvP',
        'Configurar partida: 3-10 rondas',
        'Ejecutar penalties: direcci√≥n + potencia',
        'Recibir recompensas: XP + tokens GOAL'
      ]
    },

    player_progression: {
      levels: 'Del 1 al 100 con experiencia acumulativa',
      farming_system: 'Entrenamiento obligatorio antes de competir',
      requirements: 'Nivel 5 m√≠nimo + 500 XP para jugar',
      bonuses: 'Cada 5 niveles = +1 a todas las estad√≠sticas',
      experience_sources: [
        'Goles anotados: +10 XP',
        'Fallos: +2 XP', 
        'Victorias: +50 XP',
        'Juego perfecto: +100 XP',
        'Sesiones de farming: +25 XP'
      ]
    },

    divisions_detailed: {
      primera: {
        players: ['Lionel Messi', 'Cristiano Ronaldo', 'Kylian Mbapp√©', 'Erling Haaland', 'Vinicius Junior'],
        stats_range: '95 inicial ‚Üí 171 m√°ximo',
        probability: '50% ‚Üí 90%',
        prices: 'Nivel 1: $1,000 ‚Üí Nivel 5: $5,000 USDT',
        description: 'Divisi√≥n de √©lite para gamers profesionales',
        target_audience: 'Jugadores experimentados con presupuesto alto'
      },
      segunda: {
        players: ['Cole Palmer', 'Florian Wirtz', 'Julian Alvarez', 'Achraf Hakimi', 'Alphonso Davies'],
        stats_range: '76 inicial ‚Üí 152 m√°ximo',
        probability: '40% ‚Üí 80%',
        prices: 'Nivel 1: $200 ‚Üí Nivel 5: $850 USDT',
        description: 'Divisi√≥n intermedia balanceada',
        target_audience: 'Jugadores con experiencia moderada'
      },
      tercera: {
        players: ['Jugadores emergentes', 'Talentos j√≥venes', 'Promesas del f√∫tbol'],
        stats_range: '57 inicial ‚Üí 133 m√°ximo',
        probability: '30% ‚Üí 70%',
        prices: 'Nivel 1: $30 ‚Üí Nivel 5: $130 USDT',
        description: 'Divisi√≥n inicial perfecta para comenzar',
        target_audience: 'Nuevos jugadores y presupuestos ajustados'
      }
    }
  };

  // üí∞ SISTEMA ECON√ìMICO COMPLETO
  static readonly ECONOMY_SYSTEM = {
    token_goal: {
      contract_address: '0x1e2ceb5d2b4ed8077456277ba5309f950aef2ce4',
      symbol: 'GOAL',
      decimals: 7,
      total_supply: '1,000,000,000',
      blockchain: 'Binance Smart Chain (BSC)',
      distribution: {
        play_to_earn: '30% - Recompensas para jugadores',
        community: '15% - Incentivos comunitarios',
        marketing: '10% - Promoci√≥n y crecimiento',
        liquidity: '10% - Liquidez DEX y CEX',
        burning: '10% - Mecanismo deflacionario',
        developers: '10% - Equipo de desarrollo',
        treasury: '5% - Reservas del proyecto',
        public_sale: '8% - Venta p√∫blica',
        private_sale: '2% - Inversores privados'
      }
    },

    staking_system: {
      initial_apy: '25% APY primeras 4 semanas',
      standard_apy: '12.5% APY despu√©s',
      benefits: [
        'Ingresos pasivos garantizados',
        'Acceso a eventos exclusivos', 
        'Poder de voto en decisiones',
        'Descuentos en tienda',
        'Bonificaciones especiales'
      ]
    },

    pricing_strategy: {
      tercera_division: {
        nivel_1: '$30 USDT',
        nivel_2: '$58 USDT',
        nivel_3: '$84 USDT', 
        nivel_4: '$108 USDT',
        nivel_5: '$130 USDT'
      },
      segunda_division: {
        nivel_1: '$200 USDT',
        nivel_2: '$380 USDT',
        nivel_3: '$555 USDT',
        nivel_4: '$710 USDT', 
        nivel_5: '$850 USDT'
      },
      primera_division: {
        nivel_1: '$1,000 USDT',
        nivel_2: '$1,900 USDT',
        nivel_3: '$2,775 USDT',
        nivel_4: '$3,600 USDT',
        nivel_5: '$5,000 USDT'
      }
    },

    referral_system: {
      commission_rate: '5% de por vida',
      payment_method: 'Autom√°tico en USDT',
      tracking: 'Tiempo real con dashboard completo',
      examples: [
        'Amigo compra $1,000 ‚Üí T√∫ ganas $50',
        'Amigo compra $200 ‚Üí T√∫ ganas $10', 
        'Amigo compra $30 ‚Üí T√∫ ganas $1.50'
      ]
    }
  };

  // üèóÔ∏è ARQUITECTURA T√âCNICA
  static readonly TECHNICAL_ARCHITECTURE = {
    backend: {
      framework: 'NestJS con TypeScript',
      database: 'Supabase + JSON h√≠brido',
      endpoints: '40+ endpoints REST documentados',
      authentication: 'Multi-wallet con SIWE y Solana',
      security: 'JWT, RLS, Rate Limiting, Audit Logging',
      scalability: 'Preparado para millones de usuarios concurrentes',
      modules: [
        'AuthModule - Autenticaci√≥n multi-chain',
        'WalletModule - Gesti√≥n de wallets m√∫ltiples',
        'ShopModule - Cat√°logo y productos',
        'OrderModule - √ìrdenes y pagos',
        'GachaModule - Sistema de draws',
        'InventoryModule - Jugadores y progresi√≥n',
        'PenaltyModule - Motor de gameplay',
        'LedgerModule - Contabilidad doble entrada',
        'ReferralModule - Sistema de referidos'
      ]
    },

    frontend: {
      framework: 'React 18 + TypeScript + Vite',
      styling: 'TailwindCSS con dise√±o responsive',
      animations: 'Framer Motion para UX premium',
      state_management: 'React Query para cache inteligente',
      web3_integration: 'MetaMask, WalletConnect, Multi-chain',
      pages: [
        'HomePage - Landing y estad√≠sticas',
        'GamePage - Penalty shootout',
        'ShopPage - Marketplace de packs',
        'InventoryPage - Gesti√≥n de jugadores',
        'ProfilePage - Perfil y estad√≠sticas',
        'LeaderboardPage - Rankings globales'
      ]
    },

    blockchain: {
      primary_chain: 'Binance Smart Chain (BSC)',
      future_chains: ['Ethereum', 'Solana', 'Polygon', 'Arbitrum'],
      payment_tokens: 'USDT multi-chain',
      smart_contracts: 'Estad√≠sticas y leaderboard on-chain',
      wallets_supported: ['MetaMask', 'Trust Wallet', 'WalletConnect'],
      gas_optimization: 'Batch operations y efficient storage'
    }
  };

  // üìä DATOS Y ESTAD√çSTICAS
  static readonly ECOSYSTEM_DATA = {
    database_schema: {
      total_tables: 20,
      main_entities: [
        'users - Perfiles de usuarios',
        'wallets - Wallets vinculadas', 
        'products - Cat√°logo de productos',
        'orders - √ìrdenes y pagos',
        'owned_players - Inventario NFT',
        'penalty_sessions - Partidas de penalty',
        'ledger_entries - Contabilidad completa',
        'referral_codes - Sistema de referidos'
      ],
      estimated_volume: '4+ millones de registros con 10K usuarios activos'
    },

    api_endpoints: {
      authentication: 4,
      wallet_management: 4,
      shop_catalog: 4,
      order_processing: 5,
      gacha_system: 3,
      inventory_management: 4,
      penalty_gameplay: 5,
      accounting_ledger: 2,
      referral_system: 7,
      system_monitoring: 4,
      total: '40+ endpoints completamente documentados'
    },

    real_players_data: {
      total_players: 16,
      legendary: ['Almost Messi', 'Cristiano Fernaldo', 'Kalyan Mbappi', 'Sinedine Sidini'],
      epic: ['Vini', 'Laminate Yumal', 'Newmar', 'Allaison Baker', 'Achraf Hakimi'],
      rare: ['Flor Wir', 'Willsa', 'July', 'William Saliba'],
      uncommon: ['Colpam', 'Emili Mar'],
      positions: {
        forwards: 6,
        midfielders: 3, 
        defenders: 5,
        goalkeepers: 2
      }
    }
  };

  // üéØ ESTRATEGIAS Y CONSEJOS
  static readonly STRATEGIES_AND_TIPS = {
    for_beginners: [
      'Empieza con Tercera Divisi√≥n para aprender mec√°nicas',
      'Entrena tu jugador hasta nivel 5 antes de competir',
      'Practica en Single Player antes de PvP',
      'Crea tu c√≥digo de referido inmediatamente',
      'Conecta MetaMask y a√±ade token GOAL'
    ],

    for_intermediate: [
      'Considera Segunda Divisi√≥n para mejor balance precio/performance',
      'Diversifica tu colecci√≥n con diferentes posiciones',
      'Participa en multiplayer para mayores recompensas',
      'Optimiza tu farming para maximizar XP',
      'Comparte tu c√≥digo de referido estrat√©gicamente'
    ],

    for_advanced: [
      'Invierte en Primera Divisi√≥n para m√°ximas ganancias',
      'Domina la f√≥rmula de probabilidad para estrategia',
      'Construye equipo balanceado para diferentes situaciones',
      'Maximiza staking durante per√≠odo de doble recompensas',
      'Lidera comunidades para referidos masivos'
    ],

    earning_strategies: [
      'Juega diariamente para recompensas consistentes',
      'Invita amigos para comisiones del 5%',
      'Participa en staking para ingresos pasivos',
      'Sube de nivel jugadores para mejor performance',
      'Participa en eventos especiales y torneos'
    ]
  };

  // üó£Ô∏è VARIACIONES DE LENGUAJE NATURAL
  static readonly CONVERSATION_VARIATIONS = {
    greetings: [
      '¬°Hola, futbolero!', '¬°Hey, campe√≥n!', '¬°Bienvenido!', '¬°Qu√© tal, crack!',
      '¬°Hola, leyenda!', '¬°Saludos, gamer!', '¬°Hola, champion!'
    ],
    
    excitement: [
      '¬°Incre√≠ble!', '¬°Genial!', '¬°Perfecto!', '¬°Excelente!', '¬°Fant√°stico!',
      '¬°Brutal!', '¬°Espectacular!', '¬°Impresionante!', '¬°Magn√≠fico!'
    ],
    
    transitions: [
      'Por cierto,', 'Adem√°s,', 'Tambi√©n,', 'Y otra cosa,', 'Ah, y',
      'No olvides que', 'Ten en cuenta que', 'Es importante mencionar que'
    ],
    
    encouragement: [
      '¬°Vas por buen camino!', '¬°Excelente elecci√≥n!', '¬°Perfecto!',
      '¬°Esa es la actitud!', '¬°As√≠ se hace!', '¬°Muy inteligente!'
    ],

    call_to_action: [
      '¬øTe animas?', '¬øQu√© dices?', '¬øEmpezamos?', '¬øTe parece?',
      '¬øListo para la acci√≥n?', '¬øVamos por ello?', '¬øQu√© opinas?'
    ]
  };

  // üìà DATOS EN TIEMPO REAL SIMULADOS
  static readonly LIVE_DATA_TEMPLATES = {
    user_stats: () => ({
      totalUsers: Math.floor(Math.random() * 3000) + 7000,
      activeUsers: Math.floor(Math.random() * 500) + 700,
      totalGames: Math.floor(Math.random() * 10000) + 35000,
      totalRewards: (Math.random() * 200000 + 800000).toFixed(2),
      topPlayer: 'Player#' + Math.floor(Math.random() * 9999).toString().padStart(4, '0'),
      currentPrice: (Math.random() * 0.5 + 0.1).toFixed(4),
      marketCap: (Math.random() * 5000000 + 15000000).toFixed(0)
    }),

    market_activity: () => ({
      recentPurchases: Math.floor(Math.random() * 50) + 20,
      popularPack: ['Pack Primera Nivel 1', 'Pack Segunda Nivel 3', 'Pack Tercera Nivel 5'][Math.floor(Math.random() * 3)],
      averageSession: (Math.random() * 5 + 6).toFixed(1) + ' minutos',
      peakHours: '20:00-22:00 UTC',
      conversionRate: (Math.random() * 5 + 10).toFixed(1) + '%'
    })
  };

  // üéØ RESPUESTAS CONTEXTUALES INTELIGENTES
  static getContextualResponse(topic: string, userLevel: 'beginner' | 'intermediate' | 'advanced' = 'beginner'): string {
    const responses = {
      penalty_mechanics: {
        beginner: `¬°El sistema de penalty es s√∫per emocionante! ‚öΩ

üéØ **C√≥mo Funciona**:
Cada jugador tiene 5 estad√≠sticas: velocidad, tiro, pase, defensa y porter√≠a. La suma de estas stats determina tu probabilidad de anotar.

üìä **Por Divisi√≥n**:
- Tercera: 30%-70% probabilidad
- Segunda: 40%-80% probabilidad  
- Primera: 50%-90% probabilidad

üéÆ **En el Juego**:
1. Eliges direcci√≥n (izquierda, centro, derecha)
2. Ajustas potencia (0-100%)
3. ¬°El sistema calcula si es gol!

¬øTe gustar√≠a saber m√°s sobre alguna divisi√≥n espec√≠fica? üöÄ`,

        intermediate: `¬°Perfecto! Te explico la mec√°nica avanzada del penalty üéØ

üßÆ **F√≥rmula Can√≥nica**:
- Suma substats (sin overall): speed + shooting + passing + defending + goalkeeping
- Ratio = substats / maxStats de la divisi√≥n
- Probabilidad = startingPercentage + (maxPercentage - startingPercentage) √ó ratio
- Clamp final entre 5% y 95%

‚ö° **Factores Modificadores**:
- Potencia < 50%: -20% efectividad (muy suave)
- Potencia > 90%: -40% efectividad (muy fuerte, menos control)
- Direcci√≥n = Portero: -70% efectividad (portero adivina)

üé≤ **Determinismo**: Mismo seed = mismo resultado. ¬°Totalmente justo!

¬øQuieres estrategias para maximizar tu probabilidad? üí°`,

        advanced: `¬°Excelente! Aqu√≠ tienes el an√°lisis t√©cnico completo üî¨

üìê **Implementaci√≥n Exacta**:
\`\`\`
sumSubstats = speed + shooting + passing + defending + goalkeeping
ratio = clamp(sumSubstats / maxStats, 0, 1)
chance = floor(clamp(startingPercentage + (maxPercentage - startingPercentage) * ratio, 5, 95))
roll = floor(rng * 100) + 1  // [1..100]
isGoal = roll <= chance
\`\`\`

üéØ **Optimizaci√≥n Estrat√©gica**:
- Primera Divisi√≥n: Necesitas 171 stats para 90% probabilidad
- Progresi√≥n √≥ptima: +1 stat cada 5 niveles
- ROI m√°ximo: Jugadores legendarios en Primera Divisi√≥n
- Meta-game: Farming eficiente vs tiempo de juego

¬øQuieres que analicemos tu estrategia de inversi√≥n? üìä`
      },

      tokenomics: {
        beginner: `¬°El token GOAL es el coraz√≥n de todo! üíé

ü™ô **Datos B√°sicos**:
- S√≠mbolo: GOAL
- Cantidad: 1,000,000,000 tokens
- Red: Binance Smart Chain (BSC)
- Contrato: 0x1e2ceb5d2b4ed8077456277ba5309f950aef2ce4

üí∞ **Para Qu√© Sirve**:
- Comprar packs de jugadores NFT
- Recibir recompensas por victorias
- Hacer staking para ingresos pasivos
- Votar en decisiones del proyecto

üöÄ **Oportunidad √önica**:
¬°Las primeras 4 semanas de staking dan DOBLE recompensas! Despu√©s se ajusta para sostenibilidad.

¬øQuieres que te ayude a a√±adirlo a MetaMask? ü¶ä`,

        intermediate: `¬°Perfecto! Te explico la econom√≠a completa de GOAL üìà

üíé **Distribuci√≥n Inteligente**:
- 45% para jugadores (Play-to-Earn + Community)
- 20% para crecimiento (Marketing + Liquidez)
- 10% para burning (mecanismo deflacionario)
- 25% para desarrollo y operaciones

üî• **Mecanismo Deflacionario**:
10% del supply se quema sistem√°ticamente, reduciendo oferta y aumentando valor a largo plazo.

üìä **Staking Detallado**:
- Semanas 1-4: 25% APY (doble recompensas)
- Despu√©s: 12.5% APY est√°ndar
- Beneficios extra: Acceso VIP, descuentos, governance

¬øTe interesa la estrategia de staking o prefieres saber sobre utility? üí∞`,

        advanced: `¬°Excelente! An√°lisis econ√≥mico profundo de GOAL üß†

üìä **Tokenomics Avanzados**:
- Velocity controlada con staking incentives
- Burn rate ajustable seg√∫n adoption metrics
- Multi-chain expansion decidida por governance
- Utility expansion con cada fase del roadmap

üíπ **Modelos de Valor**:
- P2E Demand: M√°s jugadores = m√°s demanda de GOAL
- Staking Lock: Reduce supply circulante
- Burn Mechanism: Presi√≥n deflacionaria constante
- Network Effects: Referrals crean viral growth

üéØ **Investment Thesis**:
- Gaming sector: $180B+ market
- P2E growth: 2000%+ en 2 a√±os
- Football passion: 4B+ fans globally
- BSC efficiency: Low fees, high throughput

¬øAnalizamos el potential price action o prefieres utility roadmap? üìà`
      }
    };

    return responses[topic]?.[userLevel] || this.getDefaultResponse();
  }

  // üé® GENERADOR DE RESPUESTAS DIN√ÅMICAS
  static generateDynamicResponse(topic: string, context?: any): string {
    const greeting = this.CONVERSATION_VARIATIONS.greetings[Math.floor(Math.random() * this.CONVERSATION_VARIATIONS.greetings.length)];
    const excitement = this.CONVERSATION_VARIATIONS.excitement[Math.floor(Math.random() * this.CONVERSATION_VARIATIONS.excitement.length)];
    const transition = this.CONVERSATION_VARIATIONS.transitions[Math.floor(Math.random() * this.CONVERSATION_VARIATIONS.transitions.length)];
    
    return `${greeting} ${excitement} ${transition} [contenido espec√≠fico del tema]`;
  }

  // üîç DETECTOR DE INTENCIONES
  static detectUserIntent(message: string): {
    intent: string;
    confidence: number;
    entities: string[];
    suggestions: string[];
  } {
    const intents = {
      learn_gameplay: ['c√≥mo jugar', 'penalty', 'mec√°nica', 'funciona'],
      buy_players: ['comprar', 'pack', 'precio', 'costo', 'adquirir'],
      understand_economy: ['token', 'GOAL', 'precio', 'staking', 'ganar dinero'],
      get_started: ['empezar', 'comenzar', 'inicio', 'start', 'nuevo'],
      referral_info: ['referido', 'invitar', 'comisi√≥n', 'amigos'],
      technical_info: ['tecnolog√≠a', 'blockchain', 'smart contract', 'c√≥digo']
    };

    // An√°lisis simple de intenci√≥n
    for (const [intent, keywords] of Object.entries(intents)) {
      if (keywords.some(keyword => message.toLowerCase().includes(keyword))) {
        return {
          intent,
          confidence: 0.8,
          entities: keywords.filter(k => message.toLowerCase().includes(k)),
          suggestions: this.getSuggestionsForIntent(intent)
        };
      }
    }

    return {
      intent: 'general',
      confidence: 0.5,
      entities: [],
      suggestions: ['¬øC√≥mo empezar?', '¬øQu√© es Goal Play?', 'Expl√≠came las divisiones']
    };
  }

  private static getSuggestionsForIntent(intent: string): string[] {
    const suggestions = {
      learn_gameplay: ['¬øC√≥mo entrenar jugadores?', '¬øQu√© divisi√≥n elegir?', '¬øC√≥mo funciona el farming?'],
      buy_players: ['¬øQu√© pack me recomiendas?', '¬øCu√°l es m√°s rentable?', '¬øC√≥mo pago?'],
      understand_economy: ['¬øC√≥mo hacer staking?', '¬øCu√°ndo sube el precio?', '¬øD√≥nde comprar GOAL?'],
      get_started: ['¬øQu√© wallet necesito?', '¬øCu√°nto dinero necesito?', '¬øEs seguro?'],
      referral_info: ['¬øC√≥mo crear mi c√≥digo?', '¬øCu√°nto gano?', '¬øC√≥mo compartir?'],
      technical_info: ['¬øEs c√≥digo abierto?', '¬øQu√© blockchain usan?', '¬øEs auditado?']
    };

    return suggestions[intent] || [];
  }

  private static getDefaultResponse(): string {
    return `¬°Hola! üëã Soy tu asistente experto en Goal Play. 

Puedo ayudarte con TODO sobre nuestro ecosistema:
üéØ Gameplay y mec√°nicas
üí∞ Econom√≠a y tokenomics  
üèÜ Estrategias de inversi√≥n
üéÆ Gu√≠as paso a paso

¬øQu√© te gustar√≠a saber? ‚öΩüöÄ`;
  }

  // üìö KNOWLEDGE BASE COMPLETA
  static getCompleteKnowledge(): any {
    return {
      ...this.GAME_MECHANICS,
      ...this.ECONOMY_SYSTEM,
      ...this.TECHNICAL_ARCHITECTURE,
      ...this.ECOSYSTEM_DATA,
      ...this.STRATEGIES_AND_TIPS
    };
  }
}